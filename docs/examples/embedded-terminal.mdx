---
title: Embedded Terminal
description: A complete example demonstrating how to embed a Claude Code terminal in an external application using iframe and the postMessage API
---

This example demonstrates embedding a Claude Code terminal into a parent application using the `TerminalEmbed` component. The parent application can send commands to the terminal and receive output through a type-safe postMessage protocol.

## Prerequisites

Install the required packages:

```bash
npm install @dotdo/terminal
```

## Complete Example

### Parent Application

The parent application embeds the terminal and manages bidirectional communication:

```tsx title="EmbeddedTerminalApp.tsx"
import { useRef, useState, useCallback } from 'react'
import {
  TerminalEmbed,
  TerminalEmbedRef,
  isTerminalMessage,
  type TerminalMessage,
} from '@dotdo/terminal/embed'

interface LogEntry {
  timestamp: Date
  type: 'info' | 'output' | 'input' | 'error' | 'system'
  message: string
}

function EmbeddedTerminalApp() {
  const terminalRef = useRef<TerminalEmbedRef>(null)
  const [logs, setLogs] = useState<LogEntry[]>([])
  const [isReady, setIsReady] = useState(false)
  const [isConnected, setIsConnected] = useState(false)
  const [terminalSize, setTerminalSize] = useState({ cols: 80, rows: 24 })
  const [commandInput, setCommandInput] = useState('')

  const addLog = useCallback((type: LogEntry['type'], message: string) => {
    setLogs((prev) => [
      ...prev.slice(-199),
      { timestamp: new Date(), type, message },
    ])
  }, [])

  const handleReady = useCallback(
    (sessionId: string) => {
      setIsReady(true)
      setIsConnected(true)
      addLog('system', `Terminal ready with session: ${sessionId}`)
    },
    [addLog]
  )

  const handleOutput = useCallback(
    (data: string) => {
      addLog('output', data)
    },
    [addLog]
  )

  const handleResize = useCallback(
    (size: { cols: number; rows: number }) => {
      setTerminalSize(size)
      addLog('info', `Terminal resized to ${size.cols}x${size.rows}`)
    },
    [addLog]
  )

  const handleError = useCallback(
    (error: string, code?: string) => {
      addLog('error', `[${code || 'UNKNOWN'}] ${error}`)
    },
    [addLog]
  )

  const handleDisconnect = useCallback(
    (reason?: string) => {
      setIsConnected(false)
      addLog('system', `Disconnected: ${reason || 'Connection closed'}`)
    },
    [addLog]
  )

  const sendCommand = useCallback(
    (cmd: string) => {
      if (!isReady || !terminalRef.current) {
        addLog('error', 'Terminal not ready')
        return
      }

      terminalRef.current.sendInput(`${cmd}\n`)
      addLog('input', `$ ${cmd}`)
    },
    [isReady, addLog]
  )

  const handleSubmitCommand = (e: React.FormEvent) => {
    e.preventDefault()
    if (commandInput.trim()) {
      sendCommand(commandInput.trim())
      setCommandInput('')
    }
  }

  return (
    <div className="min-h-screen bg-slate-900 text-white">
      {/* Header */}
      <header className="border-b border-slate-700 px-6 py-4">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-xl font-semibold">Embedded Terminal Demo</h1>
            <p className="text-sm text-slate-400">
              postMessage-based terminal embedding
            </p>
          </div>
          <div className="flex items-center gap-4">
            <span
              className={`flex items-center gap-2 text-sm ${
                isConnected ? 'text-green-400' : 'text-red-400'
              }`}
            >
              <span
                className={`h-2 w-2 rounded-full ${
                  isConnected ? 'bg-green-400' : 'bg-red-400'
                }`}
              />
              {isConnected ? 'Connected' : 'Disconnected'}
            </span>
            <span className="text-sm text-slate-500">
              {terminalSize.cols}x{terminalSize.rows}
            </span>
          </div>
        </div>
      </header>

      <main className="flex h-[calc(100vh-73px)]">
        {/* Terminal Panel */}
        <div className="flex flex-1 flex-col border-r border-slate-700">
          {/* Quick Commands */}
          <div className="flex gap-2 border-b border-slate-700 px-4 py-2">
            <button
              onClick={() => sendCommand('ls -la')}
              disabled={!isReady}
              className="rounded bg-slate-700 px-3 py-1.5 text-sm hover:bg-slate-600 disabled:cursor-not-allowed disabled:opacity-50"
            >
              List Files
            </button>
            <button
              onClick={() => sendCommand('pwd')}
              disabled={!isReady}
              className="rounded bg-slate-700 px-3 py-1.5 text-sm hover:bg-slate-600 disabled:cursor-not-allowed disabled:opacity-50"
            >
              Print Directory
            </button>
            <button
              onClick={() => sendCommand('echo "Hello from parent!"')}
              disabled={!isReady}
              className="rounded bg-slate-700 px-3 py-1.5 text-sm hover:bg-slate-600 disabled:cursor-not-allowed disabled:opacity-50"
            >
              Echo Test
            </button>
            <button
              onClick={() => sendCommand('clear')}
              disabled={!isReady}
              className="rounded bg-slate-700 px-3 py-1.5 text-sm hover:bg-slate-600 disabled:cursor-not-allowed disabled:opacity-50"
            >
              Clear
            </button>
          </div>

          {/* Custom Command Input */}
          <form
            onSubmit={handleSubmitCommand}
            className="flex gap-2 border-b border-slate-700 px-4 py-2"
          >
            <input
              type="text"
              value={commandInput}
              onChange={(e) => setCommandInput(e.target.value)}
              placeholder="Enter command..."
              disabled={!isReady}
              className="flex-1 rounded bg-slate-800 px-3 py-1.5 text-sm placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50"
            />
            <button
              type="submit"
              disabled={!isReady || !commandInput.trim()}
              className="rounded bg-blue-600 px-4 py-1.5 text-sm hover:bg-blue-500 disabled:cursor-not-allowed disabled:opacity-50"
            >
              Send
            </button>
          </form>

          {/* Terminal Embed */}
          <div className="flex-1">
            <TerminalEmbed
              ref={terminalRef}
              src="https://terminal.cod.ng"
              sessionId="demo-embedded-session"
              width="100%"
              height="100%"
              onReady={handleReady}
              onOutput={handleOutput}
              onResize={handleResize}
              onError={handleError}
              onDisconnect={handleDisconnect}
              allowClipboard
              title="Embedded Claude Code Terminal"
            />
          </div>
        </div>

        {/* Event Log Panel */}
        <div className="flex w-80 flex-col">
          <div className="flex items-center justify-between border-b border-slate-700 px-4 py-2">
            <h2 className="text-sm font-medium">Event Log</h2>
            <button
              onClick={() => setLogs([])}
              className="text-xs text-slate-400 hover:text-white"
            >
              Clear
            </button>
          </div>
          <div className="flex-1 overflow-auto p-2">
            {logs.map((log, index) => (
              <div
                key={index}
                className={`mb-1 rounded px-2 py-1 font-mono text-xs ${
                  log.type === 'error'
                    ? 'bg-red-900/30 text-red-300'
                    : log.type === 'input'
                      ? 'bg-blue-900/30 text-blue-300'
                      : log.type === 'output'
                        ? 'bg-slate-800 text-slate-300'
                        : log.type === 'system'
                          ? 'bg-green-900/30 text-green-300'
                          : 'bg-slate-800/50 text-slate-400'
                }`}
              >
                <span className="text-slate-500">
                  [{log.timestamp.toLocaleTimeString()}]
                </span>{' '}
                {log.message.slice(0, 100)}
                {log.message.length > 100 && '...'}
              </div>
            ))}
          </div>
        </div>
      </main>
    </div>
  )
}

export default EmbeddedTerminalApp
```

## postMessage Handling

The `TerminalEmbed` component abstracts postMessage communication, but understanding the protocol helps with debugging and custom implementations.

### Message Types

```typescript title="types.ts"
// Parent to iframe messages
interface TerminalInputMessage {
  type: 'terminal:input'
  data: string
}

// iframe to parent messages
interface TerminalOutputMessage {
  type: 'terminal:output'
  data: string
}

interface TerminalResizeMessage {
  type: 'terminal:resize'
  cols: number
  rows: number
}

interface TerminalReadyMessage {
  type: 'terminal:ready'
  sessionId: string
}

interface TerminalErrorMessage {
  type: 'terminal:error'
  error: string
  code?: string
}

interface TerminalDisconnectedMessage {
  type: 'terminal:disconnected'
  reason?: string
}

type TerminalMessage =
  | TerminalInputMessage
  | TerminalOutputMessage
  | TerminalResizeMessage
  | TerminalReadyMessage
  | TerminalErrorMessage
  | TerminalDisconnectedMessage
```

### Manual postMessage Implementation

For non-React applications or custom integrations:

```typescript title="manual-postmessage.ts"
const TERMINAL_ORIGIN = 'https://terminal.cod.ng'

class TerminalBridge {
  private iframe: HTMLIFrameElement
  private listeners: Map<string, Set<Function>> = new Map()

  constructor(iframe: HTMLIFrameElement) {
    this.iframe = iframe
    this.setupMessageListener()
  }

  private setupMessageListener() {
    window.addEventListener('message', (event) => {
      // Security: validate origin
      if (event.origin !== TERMINAL_ORIGIN) {
        console.warn('Rejected message from:', event.origin)
        return
      }

      const message = event.data
      if (!message?.type?.startsWith('terminal:')) return

      // Dispatch to registered listeners
      const eventType = message.type.replace('terminal:', '')
      const handlers = this.listeners.get(eventType)
      handlers?.forEach((handler) => handler(message))
    })
  }

  on(event: string, handler: Function) {
    if (!this.listeners.has(event)) {
      this.listeners.set(event, new Set())
    }
    this.listeners.get(event)!.add(handler)
    return () => this.listeners.get(event)?.delete(handler)
  }

  sendInput(data: string) {
    this.iframe.contentWindow?.postMessage(
      { type: 'terminal:input', data },
      TERMINAL_ORIGIN
    )
  }
}

// Usage
const iframe = document.querySelector('iframe')!
const terminal = new TerminalBridge(iframe)

terminal.on('ready', (msg) => console.log('Ready:', msg.sessionId))
terminal.on('output', (msg) => console.log('Output:', msg.data))
terminal.on('error', (msg) => console.error('Error:', msg.error))

// Send a command
terminal.sendInput('ls -la\n')
```

### Vanilla HTML/JavaScript Example

```html title="index.html"
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Embedded Terminal</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: system-ui, sans-serif; background: #0f172a; color: #fff; }
    .container { display: flex; height: 100vh; flex-direction: column; }
    header { padding: 1rem; border-bottom: 1px solid #334155; }
    .controls { display: flex; gap: 0.5rem; padding: 0.5rem 1rem; border-bottom: 1px solid #334155; }
    button { background: #334155; color: #fff; border: none; padding: 0.5rem 1rem;
             border-radius: 0.25rem; cursor: pointer; }
    button:hover { background: #475569; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    input[type="text"] { flex: 1; background: #1e293b; color: #fff; border: none;
                         padding: 0.5rem; border-radius: 0.25rem; }
    .main { display: flex; flex: 1; min-height: 0; }
    .terminal-panel { flex: 1; display: flex; flex-direction: column; }
    #terminal-frame { flex: 1; border: none; background: #000; }
    .log-panel { width: 300px; border-left: 1px solid #334155; display: flex;
                 flex-direction: column; }
    .log-header { padding: 0.5rem 1rem; border-bottom: 1px solid #334155;
                  display: flex; justify-content: space-between; }
    .log-content { flex: 1; overflow-y: auto; padding: 0.5rem; font-family: monospace;
                   font-size: 0.75rem; }
    .log-entry { padding: 0.25rem 0.5rem; margin-bottom: 0.25rem; border-radius: 0.25rem; }
    .log-output { background: #1e293b; }
    .log-input { background: #1e3a5f; color: #93c5fd; }
    .log-error { background: #4c1d24; color: #fca5a5; }
    .log-system { background: #14532d; color: #86efac; }
    .status { display: flex; align-items: center; gap: 0.5rem; }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; }
    .status-dot.connected { background: #22c55e; }
    .status-dot.disconnected { background: #ef4444; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div style="display: flex; justify-content: space-between; align-items: center;">
        <h1>Embedded Terminal</h1>
        <div class="status">
          <span class="status-dot disconnected" id="status-dot"></span>
          <span id="status-text">Disconnected</span>
        </div>
      </div>
    </header>

    <div class="controls">
      <button onclick="sendCommand('ls -la')" id="btn-ls">List Files</button>
      <button onclick="sendCommand('pwd')" id="btn-pwd">Print Directory</button>
      <button onclick="sendCommand('clear')" id="btn-clear">Clear</button>
      <input type="text" id="cmd-input" placeholder="Enter command..." onkeypress="handleKeyPress(event)">
      <button onclick="sendCustomCommand()" id="btn-send">Send</button>
    </div>

    <div class="main">
      <div class="terminal-panel">
        <iframe
          id="terminal-frame"
          src="https://terminal.cod.ng?session=vanilla-demo"
          allow="clipboard-read; clipboard-write"
          sandbox="allow-scripts allow-same-origin allow-forms"
          title="Embedded Terminal"
        ></iframe>
      </div>

      <div class="log-panel">
        <div class="log-header">
          <span>Event Log</span>
          <button onclick="clearLogs()" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;">Clear</button>
        </div>
        <div class="log-content" id="log-content"></div>
      </div>
    </div>
  </div>

  <script>
    const TERMINAL_ORIGIN = 'https://terminal.cod.ng'
    const iframe = document.getElementById('terminal-frame')
    const logContent = document.getElementById('log-content')
    const statusDot = document.getElementById('status-dot')
    const statusText = document.getElementById('status-text')
    let isReady = false

    // Listen for messages from terminal iframe
    window.addEventListener('message', (event) => {
      // Security: validate origin
      if (event.origin !== TERMINAL_ORIGIN) {
        console.warn('Rejected message from:', event.origin)
        return
      }

      const message = event.data
      if (!message?.type?.startsWith('terminal:')) return

      switch (message.type) {
        case 'terminal:ready':
          isReady = true
          setConnected(true)
          addLog('system', `Ready: session=${message.sessionId}`)
          break

        case 'terminal:output':
          addLog('output', message.data)
          break

        case 'terminal:resize':
          addLog('output', `Resized: ${message.cols}x${message.rows}`)
          break

        case 'terminal:error':
          addLog('error', `[${message.code || 'ERROR'}] ${message.error}`)
          break

        case 'terminal:disconnected':
          isReady = false
          setConnected(false)
          addLog('system', `Disconnected: ${message.reason || 'unknown'}`)
          break
      }
    })

    function sendCommand(cmd) {
      if (!isReady) {
        addLog('error', 'Terminal not ready')
        return
      }

      iframe.contentWindow.postMessage(
        { type: 'terminal:input', data: cmd + '\n' },
        TERMINAL_ORIGIN
      )
      addLog('input', `$ ${cmd}`)
    }

    function sendCustomCommand() {
      const input = document.getElementById('cmd-input')
      if (input.value.trim()) {
        sendCommand(input.value.trim())
        input.value = ''
      }
    }

    function handleKeyPress(event) {
      if (event.key === 'Enter') {
        sendCustomCommand()
      }
    }

    function addLog(type, message) {
      const entry = document.createElement('div')
      entry.className = `log-entry log-${type}`
      const time = new Date().toLocaleTimeString()
      entry.textContent = `[${time}] ${message.slice(0, 100)}${message.length > 100 ? '...' : ''}`
      logContent.appendChild(entry)
      logContent.scrollTop = logContent.scrollHeight
    }

    function clearLogs() {
      logContent.innerHTML = ''
    }

    function setConnected(connected) {
      statusDot.className = `status-dot ${connected ? 'connected' : 'disconnected'}`
      statusText.textContent = connected ? 'Connected' : 'Disconnected'
    }
  </script>
</body>
</html>
```

## Security Considerations

<Callout type="warning">
Always validate the message origin before processing messages. Never trust data from unknown origins.
</Callout>

### Origin Validation

```typescript
const ALLOWED_ORIGIN = 'https://terminal.cod.ng'

window.addEventListener('message', (event) => {
  // Reject messages from unexpected origins
  if (event.origin !== ALLOWED_ORIGIN) {
    console.warn('Rejected message from:', event.origin)
    return
  }

  // Safe to process
  handleTerminalMessage(event.data)
})
```

### Content Security Policy

Configure CSP headers to restrict iframe sources:

```http
Content-Security-Policy: frame-src https://terminal.cod.ng;
```

### Sandbox Permissions

Use minimal required sandbox permissions:

```html
<iframe
  src="https://terminal.cod.ng"
  sandbox="allow-scripts allow-same-origin allow-forms"
></iframe>
```

| Permission | Required For |
|------------|--------------|
| `allow-scripts` | JavaScript execution in terminal |
| `allow-same-origin` | Same-origin resource access |
| `allow-forms` | Authentication flows |

## TerminalEmbed Props Reference

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `src` | `string` | - | Base URL of the terminal application |
| `sessionId` | `string` | - | Session identifier to connect to |
| `params` | `Record<string, string>` | `{}` | Additional URL parameters |
| `onOutput` | `(data: string) => void` | - | Callback for terminal output |
| `onResize` | `(size: { cols: number; rows: number }) => void` | - | Callback for terminal resize |
| `onReady` | `(sessionId: string) => void` | - | Callback when terminal is ready |
| `onError` | `(error: string, code?: string) => void` | - | Callback for errors |
| `onDisconnect` | `(reason?: string) => void` | - | Callback when disconnected |
| `width` | `string \| number` | `'100%'` | iframe width |
| `height` | `string \| number` | `'100%'` | iframe height |
| `className` | `string` | `''` | Additional CSS class |
| `title` | `string` | `'Terminal'` | Accessibility title |
| `allowClipboard` | `boolean` | `true` | Enable clipboard access |
| `sandbox` | `string` | `'allow-scripts allow-same-origin allow-forms'` | Sandbox permissions |

## TerminalEmbedRef Methods

| Method | Signature | Description |
|--------|-----------|-------------|
| `sendInput` | `(data: string) => void` | Send input data to the terminal |

## Next Steps

- [Embedding Guide](/terminal/embedding) - Complete embedding documentation
- [Terminal Component](/terminal/components/terminal) - Direct component usage
- [IDE Layout Example](/examples/ide-layout) - Full IDE-style interface
- [Theme System](/terminal/themes) - Customize terminal appearance
